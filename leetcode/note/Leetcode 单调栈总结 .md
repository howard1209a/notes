---
title: 单调栈总结
date: 2023-11-12 09:59:29
tags: [Leetcode, 单调栈]
---

# 单调栈总结

## 单调栈概述

单调栈可以以双 O(n)的线性复杂度，得到数组中任意一个数左边/右边第一个大于它/大于等于它/小于它/小于等于它的数的位置和值。

## 构造方式

以严格单调递减栈为例：

查看栈顶元素，如果小于等于待进栈元素就不断出栈，直到栈顶元素大于待进栈元素或栈空，待进栈元素进栈。

## 证明推导

以严格单调递减栈为例：

- 任何一个元素进栈时的栈顶元素就是左边第一个比它大的元素，如果栈空则左边不存在比它大的元素。
- 任何一个元素出栈时待进栈的元素就是右边第一个大于等于它的元素，如果元素在最后一个元素进栈后还在栈中，则这个元素右边不存在大于等于它的元素。

上述结论为什么成立呢？关键在于严格单调递减栈的构造方式，我们采用数学归纳法，假设现在整个栈还没有出现过弹栈的情况，有一个待进栈元素，它向左找，所有小于等于它元素都弹栈，直到找到第一个大于它的栈顶元素就进栈，那么现在很显然栈顶元素和前一个元素之间的所有元素都是小于等于栈顶元素的，那么栈顶元素前一个元素必然是栈顶元素左边第一个比它大的元素。那么现在整个栈已经出现过了弹栈情况，又新来了一个待进栈元素，如果此时栈顶元素大于它，则可以直接进栈，栈顶元素其实就是待进栈元素的左边第一个元素，如果栈顶元素小于等于它，则我们就要弹栈考虑栈顶元素的下一个元素，那么栈顶元素和栈顶元素下一个元素在原序列中的中间元素怎么办呢？这时就要用到数学归纳法了，中间元素是一定小于等于栈顶元素的，因此也就小于等于待进栈元素。因此我们不断向右找，找到的第一个元素必然就是原序列中左边第一个比待进栈元素大的元素。

上面说的这么多其实就是证明了严格单调递减栈的结构，从左（栈底）到右（栈顶）所有元素都是严格单调递减的，任意两个栈中相邻元素之间的原序列元素，都是小于等于右边元素的。

从这个结构中，我们就很容易得出“任何一个元素出栈时待进栈的元素就是右边第一个大于等于它的元素”的结论了。

## 经典例题

力扣题目链接：[https://leetcode.cn/problems/daily-temperatures/](https://leetcode.cn/problems/daily-temperatures/)

力扣题目链接：[https://leetcode.cn/problems/next-greater-element-i/](https://leetcode.cn/problems/next-greater-element-i/)

力扣题目链接：[https://leetcode.cn/problems/next-greater-element-ii/](https://leetcode.cn/problems/next-greater-element-ii/)

力扣题目链接：[https://leetcode.cn/problems/trapping-rain-water/](https://leetcode.cn/problems/trapping-rain-water/)

力扣题目链接：[https://leetcode.cn/problems/largest-rectangle-in-histogram/](https://leetcode.cn/problems/largest-rectangle-in-histogram/)

## 对应关系

| 需求                       | 单调栈类型       |
| -------------------------- | ---------------- |
| 左边第一个大于当前元素     | 严格单调递减栈   |
| 左边第一个大于等于当前元素 | 非严格单调递减栈 |
| 左边第一个小于当前元素     | 严格单调递增栈   |
| 左边第一个小于等于当前元素 | 非严格单调递增栈 |
| 右边第一个大于当前元素     | 非严格单调递减栈 |
| 右边第一个大于等于当前元素 | 严格单调递减栈   |
| 右边第一个小于当前元素     | 非严格单调递增栈 |
| 右边第一个小于等于当前元素 | 严格单调递增栈   |

## 补充

这篇博客讲单调栈讲的不错：https://blog.csdn.net/zy_dreamer/article/details/131036101

单调栈和单调队列结构上其实是一样的。
