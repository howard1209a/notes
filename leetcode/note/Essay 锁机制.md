---
title: 锁机制
date: 2023-10-29 13:24:16
tags: [操作系统, 八股文]
---

# 锁机制

### C 语言如何实现一个锁

定义一个 int 变量，初始值为 1，上锁就是判断变量是否为 1，如果为 0 则返回 false，如果为 1 则将其置为 0 然后返回 true，释放锁就是将变量置为 1。C 语言通过开关中断的方式使得上锁过程和释放锁过程都是原语操作（或称原子操作），即都在一个时间片内完成，这是保证锁机制有效性的关键。

### Java 语言如何实现一个锁

synchronized 关键字可以在某个对象上上一把互斥锁，synchronized 关键字 native 的底层 C 语言实现依靠的就是 C 语言的锁机制。如果我们想在 java 语言中自己定义一个锁，可以像之前的 C 语言一样，定义一个 int 变量，初始值为 1，上锁就是判断变量是否为 1，如果为 0 则返回 false，如果为 1 则将其置为 0 然后返回 true，释放锁就是将变量置为 1。不同的是，C 语言通过关中断的方式保证了获取锁和释放锁的互斥执行，而 java 中需要用 synchronized 关键字保证获取锁和释放锁的互斥执行。需要注意的是，这样的锁定义可以一直套娃，利用 C 语言锁实现 java 锁 1，利用 java 锁 1 实现 java 锁 2...

### Redis 如何实现分布式锁

Redis 中的 setnx 语句可以实现分布式锁，分布式锁本质的实现方式和普通锁没有区别，只不过分布式锁可以走计算机网络从而实现不同机器间的互斥同步等操作。

非阻塞式互斥锁的标准效果就是：尝试获取锁的所有并发中，最先到达的会返回 true，之后的一律返回 false，直到某个时刻释放锁，之后最先到达的会返回 true，依此循环。无论是 C 语言的关中断也好，java 的 synchronized 也好，都是为了实现这个效果，而这个效果是 Redis 的 setnx 语句已经实现了的，所以说 Redis 很适合用来做分布式锁。
